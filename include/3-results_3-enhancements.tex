\section{Enhancements to the Attack}   %!% to/of ?

WBAES by Chow et al.\ \cite{chow2003aes} has been shown by Klinec \cite{klinec2013white} to be eqivalent to Karroumi's improved version \cite{karroumi2011protecting}. Remind that Karroumi's enhancement uses different affine mappings inside SBoxes.

Let us first remind the definition of the original SBox (originally Equation \ref{eq:sbox}),
\[
	\defsbox .
\]
Note that the original SBox is a specific affine mapping of Rijndael inverse of its input while in Karroumi's approach, this affine mapping is not fixed. Such a new SBox could be rewritten as
\begin{equation}
	S_{p,q}(A) = p\cdot A' + q \pmod{x^8+1}
\end{equation}
for $p,q\in F$ and $p$ coprime with $x^8+1$. The simplest affine mapping is obviously for $p=1$ and $q=0$ which yields $S(A) = A'$ i.e.\ only a Rijndael inverse.

Since these SBoxes are equivalent in WBAES, Bos et al.\ came up with the idea of changing the target of the attack from the original SBox to its simplest variant -- Rijndael inverse.
%?% And, surprisingly, this recovers the key even faster! (does it?)

\begin{remark}
	Technically we substitute SBoxes on Line \ref{line:s0} and \ref{line:s1} in Algorithm \ref{alg:bitwisedpa} with Rijndael inverse, hence yielding
	\begin{align*}
		S_0 &\gets \Bigl\{ Traces[n] \Bigm| \bigl(KGuess\xor PTs[n][i]\bigr)'[j] = 0 \Bigr\} , \\
		S_1 &\gets \Bigl\{ Traces[n] \Bigm| \bigl(KGuess\xor PTs[n][i]\bigr)'[j] = 1 \Bigr\} .
	\end{align*}
\end{remark}

We performed the same attack as in Section \ref{sec:klinecwbaes} with only this change, see results in Table \ref{tab:klinecrijinv}.

\begin{table}[H]
	\begin{center}
	\begin{tabular}{| c | c | c | c |}
		\hline
		Results & of attack & against {\tt KlinecWBAES} & . \\
		\hline
	\end{tabular}
	\end{center}
\caption{Bit-Wise DPA attack against {\tt KlinecWBAES}, Rijndael inverse taken as target.}
\label{tab:klinecrijinv}
\end{table}

In both cases (see results in Table \ref{tab:klinecsbox} and \ref{tab:klinecrijinv}), there are usually only few target bits which actually leak or nothing leaks at all, for each key byte. The most substantial practical benefit of attacking different targets (i.e.\ either SBox or Rijndael inverse) is that leaking bits change, therefore we can likely unveil another key bytes.

This led us to the idea of using yet another affine mappings
% nápad: co vlastně dělá $q$? že nic? no asi jo, ale radši bych si to nejdřív vyzkoušel: různý $q$ jestli daj stejný výsledky
% pokud jo, dalo by se to asi i tvrdit: jenom se totiž prohodí $S_0$ a $S_1$
% => potom zbejvá jenom tolik targetů, kolik je čísel nesoudělných s $x^8+1$ !!!

We came up with another obvious idea to try several other invertible affine mappings of Rijndael inverse besides the original SBox and the trivial mapping as a new target of the attack.

% The fact that the attack works is surprising itself

% psal já / Teuwen:
%~ > I only wonder about the reasoning why Karroumi is more than Chow since
%~ > it seems to have been shown to be equal (based on what I wrote in my
%~ > previous email).
%~ 
%~ Well I've no problem to break completely Chow with standard DCA so there
%~ is something a bit more in Karroumi. Obviously not enough to make it
%~ robust enough...

%!% nápad: podle toho co vidim v memtrace, neni lepší útočit na 0x........??..; na 0x.........??. nebo dokonce na 0x........???? místo 0x..........??
% zkus vimdiff 0.txt 1.txt v attack/enhancements
% to je ale asi uplná sračka

% we have not observed that the true key candidate would be on the bottom, or did we?